server {
    listen 80;

    # Docker's internal DNS server is at 127.0.0.11.
    # This tells Nginx to use it for DNS lookups. The 'valid=5s' part
    # is a fallback cache time, but the variable trick below makes it re-resolve anyway.
    resolver 127.0.0.11 valid=5s;

    location / {
        # Set the upstream server name to a variable.
        # This forces Nginx to use the resolver on every request.
        set $upstream_server http://webapp;

        proxy_pass $upstream_server;
    }
}